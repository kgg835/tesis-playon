
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
	<script type="text/javascript"
		src="http://maps.google.com/maps/api/js?sensor=false"></script>

	<script type="text/javascript">
		function initia(domicilio) {

			var directionsDisplay;
			var directionsService = new google.maps.DirectionsService();
			var map;
			var oldDirections = [];
			var currentDirections = null;
			var cordoba = " ,Cordoba, Argentina";
			var direccion = '#{busquedaplayaMB.direccionBusqueda}';
			var start = direccion.concat(cordoba);
			var beandireccion = domicilio;
			var end = beandireccion.concat(cordoba);
			var request = {
				origin : start,
				destination : end,
				travelMode : google.maps.DirectionsTravelMode.DRIVING
			}
			var myOptions = {
				zoom : 15,
				center : new google.maps.LatLng(#{busquedaplayaMB.latitudCentro},#{busquedaplayaMB.longitudCentro}),
				mapTypeId : google.maps.MapTypeId.ROADMAP
			}
			map = new google.maps.Map(document.getElementById("map_canvas"),
					myOptions);

			directionsDisplay = new google.maps.DirectionsRenderer({
				'map' : map,
				'preserveViewport' : true,
				'draggable' : true
			});
			directionsDisplay.setPanel(document
					.getElementById("directions_panel"));

			directionsService.route(request, function(response, status) {
				if (status == google.maps.DirectionsStatus.OK) {
					directionsDisplay.setDirections(response);
				}
			});
		}

		function undo() {
			currentDirections = null;
			directionsDisplay.setDirections(oldDirections.pop());
			if (!oldDirections.length) {
				setUndoDisabled(true);
			}
		}

		function setUndoDisabled(value) {
			document.getElementById("undo").disabled = value;
		}
	</script>

	<h:form id="form">

		<p:growl id="messages" />
		<div align="center">

			<h:panelGrid columns="4" cellspacing="10" cellpadding="8">
				<p:column>
					<h:outputLabel for="direccionBusqueda"
						value="Dirección de búsqueda: " />
				</p:column>
				<p:column>
					<p:inputText id="direccionBusqueda"
						value="#{busquedaplayaMB.direccionBusqueda}" required="true"
						requiredMessage="Campo obligatorio">
						<p:ajax event="blur" update="direccionBusquedaMsg" />
					</p:inputText>
				</p:column>

				<p:column style="vertical-align: center;">
					<div align="right">
						<h:outputLabel for="distancia" value="N° de cuadras: " />
					</div>
				</p:column>
				<p:column>
					<p:inputText id="distancia" value="#{busquedaplayaMB.distancia}" />
				</p:column>

				<p:column />
				<p:column>
					<p:message id="direccionBusquedaMsg" for="direccionBusqueda"
						display="text" />
				</p:column>

				<p:column />
				<p:column>
					<p:slider for="distancia" minValue="1" maxValue="50" />
				</p:column>
				<p:column />

				<p:column />
				<p:column>
					<p:commandLink id="btnOpcionesAvanzadas" value="opciones avanzadas"
						action="#{busquedaplayaMB.settearOpcionesAvanzadas()}"
						ajax="false" immediate="true"
						rendered="#{!busquedaplayaMB.opcionesAvanzadas}" />
				</p:column>
				<p:column>
					<div align="right">
						<p:commandButton id="btnBuscarId" update="playas,mapa"
							style="width:110px;" value="Buscar"
							action="#{busquedaplayaMB.buscarPlaya}" ajax="false"
							rendered="#{!busquedaplayaMB.opcionesAvanzadas}" />
					</div>
				</p:column>


				<p:column rendered="#{busquedaplayaMB.opcionesAvanzadas}">
					<div align="right">
						<h:outputLabel for="nombrePlaya" value="Nombre de la playa: " />
					</div>
				</p:column>
				<p:column rendered="#{busquedaplayaMB.opcionesAvanzadas}">
					<p:inputText id="nombrePlaya"
						value="#{busquedaplayaMB.nombrePlayaParameter}" />
				</p:column>
				<p:column rendered="#{busquedaplayaMB.opcionesAvanzadas}">
					<h:outputLabel for="nombrePlaya" value="Promociones: " />
				</p:column>
				<p:column rendered="#{busquedaplayaMB.opcionesAvanzadas}">
					<p:selectOneRadio id="check"
						value="#{busquedaplayaMB.checkPromociones}">
						<f:selectItem itemLabel="SI&#160;&#160;&#160;&#160;&#160;&#160;"
							itemValue="1" />
						<f:selectItem itemLabel=" NO" itemValue="0" />
					</p:selectOneRadio>
				</p:column>


				<p:column rendered="#{busquedaplayaMB.opcionesAvanzadas}">
					<div align="right">
						<h:outputText value="Categoría: " />
					</div>
				</p:column>

				<p:column rendered="#{busquedaplayaMB.opcionesAvanzadas}">
					<p:selectOneMenu value="#{busquedaplayaMB.categoriaParameter}"
						effect="fade" style="width:130px;">
						<f:selectItem itemLabel="Todas" itemValue="" />
						<f:selectItems
							value="#{categoriaVehiculoMB.categoriaVehiculoList}"
							var="categoria" itemValue="#{categoria}"
							itemLabel="#{categoria.nombre}" />
						<f:converter converterId="categoriaVehiculoConverter" />
					</p:selectOneMenu>
				</p:column>

				<p:column rendered="#{busquedaplayaMB.opcionesAvanzadas}">
					<div align="right">
						<h:outputText value="Tipo estadía: " />
					</div>
				</p:column>

				<p:column rendered="#{busquedaplayaMB.opcionesAvanzadas}">
					<p:selectOneMenu value="#{busquedaplayaMB.tipoEstadiaParameter}"
						effect="fade" style="width:130px;">
						<f:selectItem itemLabel="Todas" itemValue="" />
						<f:selectItems value="#{tipoEstadiaMB.tipoEstadiaList}"
							var="tipoEstadia" itemValue="#{tipoEstadia}"
							itemLabel="#{tipoEstadia.nombre}" />
						<f:converter converterId="tipoEstadiaConverter" />
					</p:selectOneMenu>
				</p:column>

				<p:column />
				<p:column />
				<p:column />
				<p:column rendered="#{busquedaplayaMB.opcionesAvanzadas}">
					<div align="right">
						<p:commandButton id="btnBuscarAvanzado" update="playas,mapa"
							value="Buscar" action="#{busquedaplayaMB.busquedaAvanzada}"
							ajax="false" style="width:130px;" />
					</div>
				</p:column>



			</h:panelGrid>
		</div>

		<div>
			<f:view contentType="text/html">
				<!-- 				<h1>Playas encontradas:</h1> -->
				<script src="http://maps.google.com/maps/api/js?sensor=false"
					type="text/javascript"></script>

				<p:gmap center="#{busquedaplayaMB.coordenadas}" zoom="14"
					type="ROADMAP" model="#{busquedaplayaMB.advancedModel}"
					style="width:99,5%; height:350px; border:2px solid #819FF7;">

					<p:ajax event="overlaySelect"
						listener="#{busquedaplayaMB.onMarkerSelect}" />

					<p:gmapInfoWindow>
						<div align="center">
							<h:panelGrid column="1" style="text-align:center;"
								cellspacing="0px" cellpadding="0px">
								<p:column>
									<h:graphicImage library="fotos_perfil_playas"
										name="#{busquedaplayaMB.marker.data.id}_#{busquedaplayaMB.marker.data.nombreFoto}"
										styleClass="bordes-foto-perfil-comentario"
										rendered="#{busquedaplayaMB.marker.data.nombreFoto != null}" />
									<h:graphicImage library="fotos_perfil_playas"
										name="sinfoto.jpg" styleClass="bordes-foto-perfil-comentario"
										rendered="#{busquedaplayaMB.marker.data.nombreFoto == null}" />
								</p:column>
								<h:outputText
									value="#{busquedaplayaMB.marker.data.playa.nombreComercial}" />

								<h:outputText
									value="#{busquedaplayaMB.marker.data.playa.domicilio}" />

								<h:outputText
									value="#{busquedaplayaMB.marker.data.playa.barrio.nombre}" />
								<h:link id="link" tittle="Ir a playa" value="Ver información"
									outcome="/viewperfilplaya.html?id=#{busquedaplayaMB.marker.data.playa.id}" />

							</h:panelGrid>
						</div>
					</p:gmapInfoWindow>
				</p:gmap>
			</f:view>
		</div>

		<p:dataTable id="playas" var="playa" paginator="true"
			paginatorPosition="bottom" rows="5"
			emptyMessage="¡No existen playas!"
			value="#{busquedaplayaMB.playaResultadoBusqueda}">

			<p:column headerText="Nombre Comercial" styleClass="column-font">
				<p:cellEditor>
					<f:facet name="output">
						<h:outputText value="#{playa.nombreComercial}" />
					</f:facet>
					<f:facet name="input">
						<p:inputText value="#{playa.nombreComercial}"
							styleClass="input-font" />
					</f:facet>
				</p:cellEditor>
			</p:column>

			<p:column headerText="Barrio" styleClass="column-font">
				<h:outputText value="#{playa.barrio.nombre}" />
			</p:column>

			<p:column headerText="Domicilio" styleClass="column-font">
				<h:outputText value="#{playa.domicilio}" />
			</p:column>

			<p:column headerText="Perfil" style="text-align:center; width:50px;">

				<h:link id="verPerfil" title="Ver perfil"
					outcome="/viewperfilplaya.html?id=#{playa.id}">
					<h:graphicImage library="images/icons" name="go.png" />
				</h:link>
			</p:column>

			<p:column headerText="Ruta" style="text-align:center; width:50px;">
				<p:commandLink id="view2" oncomplete="dlg2.show();"
					onstart="initia('#{playa.domicilio}');" title="Ver Datos">
					<h:graphicImage library="images/icons" name="search-map.png"
						style="height:40px; width:40px" />
				</p:commandLink>

			</p:column>
		</p:dataTable>

		<p:dialog widgetVar="dlg2" width="1000" height="550" modal="true"
			id="dialog" draggable="false" closable="false">
			<f:facet name="header">
				<h:outputText value="¿Cómo llegar a la playa?" />
			</f:facet>
			<div id="map_canvas" style="float: left; width: 65%; height: 100%"></div>
			<div style="float: right; width: 35%; height: 100%; overflow: auto">
				<div id="directions_panel" style="width: 100%"></div>
			</div>
			<f:facet name="footer" style="text-align=right;">
				<p:commandButton id="undo" value="Volver"
					style="float:left; width:640px; height: 42px" onclick="undo();"></p:commandButton>
			</f:facet>
		</p:dialog>

	</h:form>
</ui:composition>


